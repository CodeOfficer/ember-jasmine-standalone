# read more at:
# http://rubydoc.info/gems/rake-pipeline/0.5.0/frames
# http://stackoverflow.com/questions/8558062/setting-up-rake-pipeline-for-use-with-handlebars-alongside-google-app-engine

require "rake-pipeline-web-filters"
require 'haml'
require 'sass'

output 'www'


input "assets", "*.haml" do |x|
  # Compile each HAML file using Tilt, removing the haml extension.
  filter(Rake::Pipeline::Web::Filters::TiltFilter) do |input|
    input.sub(/\.haml$/, '')
  end
end

input "assets/stylesheets/application", "**/*.{css,scss}" do
  # compile CSS and SCSS files using the SCSS
  # compiler. if an input file has the extension
  # scss, replace it with css
  filter(Rake::Pipeline::Web::Filters::TiltFilter) do |input|
    input.sub(/\.scss$/, 'css')
  end
  # then, concatenate all CSS files into a single file
  filter Rake::Pipeline::ConcatFilter, "application.css"
end


input "assets/stylesheets/test", "**/*.{css,scss}" do
  # compile CSS and SCSS files using the SCSS
  # compiler. if an input file has the extension
  # scss, replace it with css
  filter(Rake::Pipeline::Web::Filters::TiltFilter) do |input|
    input.sub(/\.scss$/, 'css')
  end
  # then, concatenate all CSS files into a single file
  filter Rake::Pipeline::ConcatFilter, "test.css"
end

input "assets/javascripts/test", "**/*.js" do
  filter(Rake::Pipeline::OrderingConcatFilter, [
    'jasmine.js',
    'jasmine-html.js'
  ], 'test.js')
end

